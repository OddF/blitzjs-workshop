# Configure CI

Now that we have created all our resources we can start configuring deployment to Azure.

## Adding initial workflow file

In Azure portal select your WebApp and navigate to `Deployment center`.

Open the `settings` tab. 
We'll choose `GitHub Actions` for this workshop, for real world applications Azure Pipelines might be a better fit.

Authorize access to your github account and fill the fields.
Now you will need to Authorize access to your GitHub account.

Add all required fields.
For Registry source use `Azure Container Registry` and the registry created in step 13 for Registry.

The placeholder image should appear in the dropdowns, if not jump back to step 13, and verify that the commands where run correctly.

Hit `Save`, open your repository in github and navigate to actions. Now you can se that the action is started.
NOTE: In the project settings you can se a couple of secrets has been added. These are used to authorize the workflow.

## Make our workflow migrate our database

We're not quite happy with the file generated by azure, so we will need to modify it a bit.

Lets pull down the changes in our repository and open the file.
It should be placed in a newly created `.github/workflows` directory

We will do the database migration as part of our CI, to accomplish this we need to add a migrate step.

As the production image does not contain the necessary dependencies to perform the migration we will need to target the builder image.
We'll tag it as largeImage so that we can easily run it

```yaml
- name: Run migration against database
      run: |
        docker build -t builderimage --target builder .
        docker run -e DATABASE_URL='${{ secrets.DATABASE_URL }}' --entrypoint 'bash' builderimage -c 'npx blitz prisma migrate deploy --preview-feature'
```

## Adding the DATABASE_URL 

When we updated the workflow we used a reference to the database url, but unlike the login information for the registry this has not been added into the repository secrets. Navigate to project secrets and add the DATABASE_URL=


